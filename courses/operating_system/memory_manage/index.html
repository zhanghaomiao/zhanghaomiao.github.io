<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  

  
  
  
  
  
    
    
    
  
  

  

  
  
  
    
  
  <meta name="description" content="Background  Main memory and registers are the only storage CPU can access directly Collection of processes are waiting on disk to be brought into memory and be executed Multiple programs are brought into memory to improve resource utilization and response time to users A process may be moved between disk and memory during its execution Multistep processing of a program   Address Binding  Address Binding - Compile Time  Program is written as symbolic code Compiler translates symbolic code into absolute code If starting location changes (recompile)   Address Binding - Load Time  Complier translates symbolic code into relocatable code Relocatable code: machine language that can be run from any memory location If starting location changes (reload the code)   Address Binding - Execution Time  Compiler translates symbolic code into logical-address (virtual-address) code Special hardware (MMU memory management unit) is needed for this scheme Most general-purpose OS use this method   MMU(Memory-management unit)  Hardware device that maps virtual to physical address The value in the relocation register is added to every address generated by a user process at the time it is sent to memory    Logical VS.">

  
  <link rel="alternate" hreflang="en-us" href="/courses/operating_system/memory_manage/">

  


  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  <script src="/js/mathjax-config.js"></script>
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/atom-one-light.min.css" crossorigin="anonymous" title="hl-light">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/atom-one-light.min.css" crossorigin="anonymous" title="hl-dark" disabled>
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/courses/operating_system/memory_manage/">

  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Haomiao">
  <meta property="og:url" content="/courses/operating_system/memory_manage/">
  <meta property="og:title" content="Memory Management | Haomiao">
  <meta property="og:description" content="Background  Main memory and registers are the only storage CPU can access directly Collection of processes are waiting on disk to be brought into memory and be executed Multiple programs are brought into memory to improve resource utilization and response time to users A process may be moved between disk and memory during its execution Multistep processing of a program   Address Binding  Address Binding - Compile Time  Program is written as symbolic code Compiler translates symbolic code into absolute code If starting location changes (recompile)   Address Binding - Load Time  Complier translates symbolic code into relocatable code Relocatable code: machine language that can be run from any memory location If starting location changes (reload the code)   Address Binding - Execution Time  Compiler translates symbolic code into logical-address (virtual-address) code Special hardware (MMU memory management unit) is needed for this scheme Most general-purpose OS use this method   MMU(Memory-management unit)  Hardware device that maps virtual to physical address The value in the relocation register is added to every address generated by a user process at the time it is sent to memory    Logical VS."><meta property="og:image" content="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png">
  <meta property="twitter:image" content="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_2.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2019-05-05T00:00:00&#43;01:00">
    
    <meta property="article:modified_time" content="2019-05-05T00:00:00&#43;01:00">
  

  



  


  


  





  <title>Memory Management | Haomiao</title>

</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class=" ">

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Haomiao</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Haomiao</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/post/"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link " href="/books/"><span>Books</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Courses</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/courses/"><span>All Courses</span></a>
            
              <a class="dropdown-item" href="/courses/deep_learning"><span>Deep Learning</span></a>
            
              <a class="dropdown-item" href="/courses/operating_system"><span>Operating system</span></a>
            
              <a class="dropdown-item" href="/courses/computer_network"><span>Computer network</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>Home</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      <li class="nav-item dropdown theme-dropdown">
        <a href="#" class="nav-link js-theme-selector" data-toggle="dropdown" aria-haspopup="true">
          <i class="fas fa-palette" aria-hidden="true"></i>
        </a>
        <div class="dropdown-menu">
          <a href="#" class="dropdown-item js-set-theme-light">
            <span>Light</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-dark">
            <span>Dark</span>
          </a>
          <a href="#" class="dropdown-item js-set-theme-auto">
            <span>Automatic</span>
          </a>
        </div>
      </li>
      

      

    </ul>

  </div>
</nav>



  

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      





  
    
  




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  

  
  
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/operating_system/">Overview</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/operating_system/os_structures/">Concepts</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/operating_system/os_structures/">OS structures</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/process/">Process</a>
      </li>
      
      <li class="active">
        <a href="/courses/operating_system/memory_manage/">Memory Management</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/virtual_memory/">Virtual Memory</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/multithread_programming/">Multithread Programming</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/process_schedule/">Process Scheduling</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/process_synchronization/">Process Synchronization</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/deadlocks/">DeadLocks</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/file_system_interface/">File System Interface</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/file_system_implementatin/">File System Implementation</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/mass_storage_system/">Mass Storage System</a>
      </li>
      
      <li >
        <a href="/courses/operating_system/io_system/">I/O system</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">Contents</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#background">Background</a>
      <ul>
        <li><a href="#address-binding">Address Binding</a></li>
        <li><a href="#dynamic-loading">Dynamic loading</a></li>
        <li><a href="#staticdynamic-linking">Static/Dynamic Linking</a></li>
        <li><a href="#swapping">Swapping</a></li>
      </ul>
    </li>
    <li><a href="#memory-allocation">Memory allocation</a>
      <ul>
        <li><a href="#multiple-partition-variable-size-method">Multiple Partition (Variable-size) method</a></li>
        <li><a href="#fragmentation-存在零碎的空间">Fragmentation (存在零碎的空间)</a></li>
      </ul>
    </li>
    <li><a href="#non-contiguous-memory-allocation---paging">Non-contiguous memory Allocation - Paging</a>
      <ul>
        <li><a href="#page-table">Page table</a></li>
        <li><a href="#address-translation-scheme">Address Translation Scheme</a></li>
        <li><a href="#paging-summary">Paging Summary</a></li>
        <li><a href="#implementation-of-page-table">Implementation of Page Table</a></li>
        <li><a href="#memory-protection">Memory Protection</a></li>
        <li><a href="#page-table-memory-structure">Page Table Memory Structure</a></li>
      </ul>
    </li>
    <li><a href="#segmentation">Segmentation</a>
      <ul>
        <li><a href="#segmentation-table">Segmentation Table</a></li>
        <li><a href="#segmentation-hardware">Segmentation Hardware</a></li>
      </ul>
    </li>
    <li><a href="#segmentation--paging">Segmentation &amp; paging</a>
      <ul>
        <li><a href="#address-translation">Address Translation</a></li>
        <li><a href="#example">Example</a></li>
      </ul>
    </li>
  </ul>
</nav>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <article class="article">

        <div class="docs-article-container">
          <h1>Memory Management</h1>

          <div class="article-style">
            <h2 id="background">Background</h2>
<ul>
<li>Main memory and registers are the <strong>only storage CPU can access directly</strong></li>
<li><strong>Collection of processes</strong> are waiting on disk to be brought into memory and be executed</li>
<li>Multiple programs are brought into memory to improve resource utilization and response time to users</li>
<li>A process may be <strong>moved between disk and memory</strong> during its execution</li>
<li>Multistep processing of a program
<img src="https://i.loli.net/2019/03/15/5c8b937772940.png" width="30%"/></li>
</ul>
<h3 id="address-binding">Address Binding</h3>
<ul>
<li>Address Binding - Compile Time
<ul>
<li>Program is written as symbolic code</li>
<li>Compiler translates symbolic code into <strong>absolute code</strong></li>
<li>If starting location changes <strong>(recompile</strong>)</li>
</ul>
</li>
<li>Address Binding - Load Time
<ul>
<li>Complier translates symbolic code into relocatable code</li>
<li>Relocatable code: machine language that can be run from any memory location</li>
<li>If starting location changes (reload the code)</li>
</ul>
</li>
<li>Address Binding - Execution Time
<ul>
<li>Compiler translates symbolic code into logical-address (virtual-address) code</li>
<li>Special hardware (MMU memory management unit) is needed for this scheme</li>
<li>Most general-purpose OS use this method</li>
</ul>
</li>
<li>MMU(Memory-management unit)
<ul>
<li>Hardware device that <strong>maps virtual to physical address</strong></li>
<li>The value in the <strong>relocation register is added to every address</strong> generated by a user process at the time it is sent to memory
<img src="https://i.loli.net/2019/03/15/5c8b998d7bef2.png" width="40%"/></li>
</ul>
</li>
<li>Logical VS. Physical Address
<ul>
<li>Logical Address — generated by CPU (a.k.a virtual address)</li>
<li>Physical address — seen by the memory module</li>
<li>Compile-time &amp; load time address binding (logical address = physical address)</li>
<li>Execution-time address binding (logical address $\neq$ physical address)</li>
<li>The user program deals with logical addresses; it never sees the real physical addresses</li>
</ul>
</li>
</ul>
<h3 id="dynamic-loading">Dynamic loading</h3>
<ul>
<li>The entire program doesn&rsquo;t need all memory for it to execute, it&rsquo;s a routine is loaded into memory when it is called</li>
<li>Better memory-space utilization, unused routine is never loaded, particularly useful when large amounts of code are infrequently used (e.g., error handling code)</li>
<li>No special support from OS is required implemented through program (library, API calls)</li>
<li>Dynamic Loading Example in C
<ul>
<li><code>dlopen()</code>: opens a library and prepares it for use</li>
<li><code>desym()</code>: looks up the value of a symbol in a given opened library</li>
<li><code>dlclose()</code>: close a DL library</li>
</ul>
</li>
</ul>
<pre><code class="language-C">#include &lt;dlfcn.h&gt;
int main() {
    double (*cosine)(double);
    void* handle = dlopen(&quot;/lib/libm.so.6&quot;, RTLD_LAZY);
    cosine = dlsym(handle, &quot;cos&quot;);
    printf(&quot;%f\n&quot;, (*cosine)(2.0)); // load into memory
    dlclose(handle);
} 
</code></pre>
  <img src="https://i.loli.net/2019/03/15/5c8b9e9388d4f.png" width="30%"/>
<h3 id="staticdynamic-linking">Static/Dynamic Linking</h3>
<ul>
<li>Static Linking: libraries are combined by the loaded into  the program in-memory image
<ul>
<li>Waste memory: duplicated code</li>
<li>Faster during execution time
<img src="https://i.loli.net/2019/03/15/5c8ba03c16a1b.png" width="30%"/></li>
</ul>
</li>
<li>Dynamic Linking: Linking postponed until execution time
<ul>
<li>Only one code copy in memory and shared by everyone</li>
<li>A stub is included in the program in-memory image for each lib reference</li>
<li>Stub call $\rightarrow$ check if the referred lib is in memory $\rightarrow$ if not, load the lib $\rightarrow$ execute the lib</li>
<li>DLL (Dynamic link library) on Windows
<img src="https://i.loli.net/2019/03/15/5c8ba17ef00e8.png" width="10%"/></li>
</ul>
</li>
</ul>
<h3 id="swapping">Swapping</h3>
<ul>
<li>A process can be swapped out of memory to a <strong>backing store</strong>, and later brought back into memory for continuous execution, also used by <strong>midterm scheduling</strong>, different from context switch</li>
<li><strong>Backing store</strong>: a chunk of disk, separated from file system, to provide direct access to these memory images</li>
<li>Free up memory, roll out, roll in, swap lower-priority process with a higher one</li>
<li>Swap back memory location
<ol>
<li>if binding is done at compile / load time, swap back memory address must be same</li>
<li>if binding is done at execution time, swap back memory address can be different</li>
</ol>
</li>
<li>A process to be swapped == must be idle (不能做I/O)
<ul>
<li>Imagine a process that is waiting for I/O is swapped? 1. Never swap a process with pending I/O 2. I/O operations are done through OS buffers (i.e. a memory space not belongs to any user processes)</li>
</ul>
</li>
<li>Major part os swap time is transfer time; total transfer time is directly proportional to the amount of memory swapped</li>
</ul>
<h2 id="memory-allocation">Memory allocation</h2>
<ul>
<li>Fixed-partition allocation (规划停车场)
Each process loads into one partition of fixed-size, degree of multi-programming is bounded by the number of partitions</li>
<li>Variable-size partition
Hole: block of contiguous free memory, holes of various size are scattered in memory</li>
</ul>
<h3 id="multiple-partition-variable-size-method">Multiple Partition (Variable-size) method</h3>
<ol>
<li>First-fit allocate the 1st hole that fits</li>
<li>Best-fit allocate the smallest hole that fits (must search through the whole list)</li>
<li>Worst-fit allocate the largest hole (must also search through the whole list)</li>
<li>First-fit and best-fit better than worst-fit in terms of speed and storage utilization</li>
</ol>
<h3 id="fragmentation-存在零碎的空间">Fragmentation (存在零碎的空间)</h3>
<ul>
<li>external fragmentation
Total free memory space is big enough to satisfy a request, but is not contiguous, occur in variable-size allocation</li>
<li>Internal fragmentation
<ul>
<li>Memory that is internal to a partition but is not being used, occur in fixed-partition allocation</li>
</ul>
</li>
<li>Solution: compaction
<ul>
<li>Shuffle the memory contents to place all free memory together in one large block at execution time</li>
<li>Only if binding is done at execution time
<img src="https://i.loli.net/2019/03/15/5c8ba92f9fed7.png" width="25%"/></li>
</ul>
</li>
</ul>
<h2 id="non-contiguous-memory-allocation---paging">Non-contiguous memory Allocation - Paging</h2>
<ul>
<li>Divide physical memory into fixed-sized blocks called <strong>frames</strong></li>
<li>Divide logical address space into blocks of the same size called <strong>pages</strong></li>
<li>To run a program of n pages, need to find n free frames and load the program</li>
<li><strong>keep track of free frames</strong></li>
<li>Set up a <strong>page table</strong> to translate logical to physical addresses</li>
<li>Benefit
<ul>
<li>Allow the physical-address space of a process to be noncontiguous</li>
<li>Avoid external fragmentation</li>
<li>Limited internal fragmentation</li>
<li>Provide <strong>shared memory/pages</strong></li>
</ul>
</li>
</ul>
<h3 id="page-table">Page table</h3>
<ul>
<li>Each entry maps to the base address of a page in physical memory</li>
<li>A structure maintained by OS for each process
<ul>
<li>page table includes only pages owned by a process</li>
<li>A process cannot access memory outside its space
<img src="https://i.loli.net/2019/03/15/5c8baa11b9f0c.png" width="400px"/></li>
</ul>
</li>
</ul>
<h3 id="address-translation-scheme">Address Translation Scheme</h3>
<ul>
<li>Logical address is divided into two parts
<ul>
<li>Page number (p)
Use as an index into a page table which contains base address of each page in physical memory, N bits means a process can allocate at most $2^{N}$ pages</li>
<li>Page offset(d)
Combines with base address to define the physical memory address that is sent to the memory unit, N bits means the page size is $2^{N}$</li>
</ul>
</li>
<li>Physical address = page base address + page offset</li>
<li>example: If page size is 1KB(2^10) and page 2 maps to frame 5. Given 13 bits logical address: (p=2, d=20), what is physical address?
$$5*(1KB) + 20 = 1,010,000,000,000 + 0,000,010,100 = 1,010,000,010,100$$</li>
<li>Figure
<img src="https://i.loli.net/2019/03/16/5c8c64134af0b.png" width="400px"/></li>
<li>total number of pages dose not need to be the same as the total number of frames</li>
<li>Given 32 bits logical address, 36 bits physical address and 4KB page size, what does it mean?
<ul>
<li>Page table size: $2^{32} / 2^{12} = 2^{20}$ entries</li>
<li>Max program memory: $2^{32} = 4GB$</li>
<li>Total physical memory size: $2^{36} = 64GB$</li>
<li>Number of bits for page number: $2^{20}$ pages $\rightarrow 20$ bits</li>
<li>Number of bits for frame number: $2^{24} \text{frames} \rightarrow 2^24$ bits</li>
<li>number of bits for page offset: 4KB page size = $2^{12}$ bytes $\rightarrow 12$</li>
</ul>
</li>
<li>Page / Frame Size
<ul>
<li>Typically power of 2</li>
<li>Ranging from 512 bytes to 16 MB/ page, 4KB/8KB page is commonly used</li>
<li>Larger page size $\rightarrow$ More space waste</li>
<li>page sizes have grown over time , memory, process, data sets have become larger</li>
</ul>
</li>
</ul>
<h3 id="paging-summary">Paging Summary</h3>
<ol>
<li>Paging helps separate user&rsquo;s view of memory and the actual physical memory</li>
<li>User view&rsquo;s memory: one single contiguous space</li>
<li>OS maintains a copy of the <strong>page table for each process</strong></li>
<li>OS maintains a frame table for managing physical memory
<ol>
<li>One entry for each physical frame</li>
<li>Indicate whether a frame is free or allocated</li>
<li>If allocated, to which page of which process or processes</li>
</ol>
</li>
</ol>
<h3 id="implementation-of-page-table">Implementation of Page Table</h3>
<ol>
<li>Page table is kept in memory</li>
<li>Page table base register (PTBR) (需要load到MMU的register)
<ul>
<li>The physical memory address of the page table</li>
<li>The PTBR value is stored in PCB (Process Control Block)</li>
<li>Changing the value of PTBR during <strong>Context-switch</strong></li>
</ul>
</li>
<li>With PTBR, each memory reference results in 2 memory reads, one for the page table and one for the real address</li>
<li>The 2-access problem can be solved by, <strong>Translation Look-aside Buffers</strong>(TLB) which is implemented by <strong>Associative memory</strong></li>
<li>Associative Memory
All memory entries can be accessed <strong>at the same time</strong>, lookup time is O(1), each entry corresponds to an associative register, the number of entries are limited (64 ~ 1024)
<img src="https://i.loli.net/2019/03/17/5c8da6019d2c1.png" width="400px"/>
<div class="note info"><p> TLB is a cache for page table shared by all processes </p></div>
</li>
<li>TLB must be flushed after a context switch, otherwise, TLB entry must has a PID field (address-space identifiers (ASIDs)), the flush method is preferred.</li>
<li>Effective Memory-Access Time (EMAT)
<ol>
<li>$20 ns$ for TLB search</li>
<li>$100 ns$ for memory access</li>
<li>$70%$ TLB hit-ratio
<ul>
<li>$70$ TLB hit-ratio $\text{EMAT} = 0.7\times (20+100) + (1-0.7) \times (20+100+100) = 150ns$</li>
<li>$98%$ TLB hit-ration $\text{EMAT} = 0.98\times 120+0.02 \times 220=122ns$</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="memory-protection">Memory Protection</h3>
<ol>
<li>Each page is associated with a set of <strong>protection bit</strong> in the page table
<div class="note info"><p>(A bit to define read/write/execution permission)</p></div>
</li>
<li>Common use : valid-invalid bit
<ul>
<li>Valid: the page/frame is in the process&rsquo; logical address space, and is thus a legal page</li>
<li>Invalid: the page/frame is not in the process&rsquo; logical address space</li>
<li>potential issues: Un-used page entry cause memory-waste, use page table length register(PTLR)</li>
<li>Process memory may NOT be on the boundary of a page, memory limit register is still needed
<img src="https://i.loli.net/2019/03/17/5c8db2c2cdea7.png" width="400px"/></li>
</ul>
</li>
<li>Shared Pages
Paging allows processes share common code, which must be reentrant
<ul>
<li>Reentrant code (pure code): it never change during execution, text editors, compilers, web servers, etc</li>
<li><strong>Only one copy</strong> of the shared code needs to be kept in physical memory</li>
<li><strong>Two (several) virtual addresses</strong> are mapped to one physical address</li>
<li>Process keeps a copy of its own private data and code</li>
<li>Shared code must appear in the same location in the logical address space of all processes
<img src="https://i.loli.net/2019/03/17/5c8db414864da.png" width=400px/></li>
</ul>
</li>
</ol>
<h3 id="page-table-memory-structure">Page Table Memory Structure</h3>
<ul>
<li>Page table could be huge and difficult to be loaded
<ul>
<li>4GB ($2^{32}$) logical address space with 4KB ($2^{12}$) page, needs 1 million $2^{20}$ page table entry</li>
<li>Assume each entry need 4 bytes (32 bits), total size = 4MB (MMU 读的时候是需要连续的4MB memory)</li>
<li>Need to break it into several smaller page tables, better within  a single page size (i.e. 4KB)</li>
<li>Or reduces the total size of page table</li>
</ul>
</li>
</ul>
<h4 id="hierarchical-paging">Hierarchical Paging</h4>
<ul>
<li>Break up the logical address space into multiple page tables
<ul>
<li>12-bit offset (d) $\rightarrow$ 4KB($2^{12}$) page size</li>
<li>10-bit outer page number $\rightarrow$ 1K $2^{10}$ page table entries</li>
<li>10-bit inner page number $\rightarrow$ 1K $2^{10}$ page table entries
<img src="https://i.loli.net/2019/03/17/5c8ddfd25900c.png" width="400px"/></li>
</ul>
</li>
<li>Two-level paging example(32-bit address with 4KB ($2^{12}$) page size)
<img src="https://i.loli.net/2019/03/17/5c8dbf784c160.png" width="400px"/></li>
<li>example: <img src="https://i.loli.net/2019/04/01/5ca17e7a97138.png" width="400px"/></li>
<li>64-bit Address?
<ol>
<li>2 level: 42(p1) + 10 (p2) + 12 (offset), outer table requires $2^{42} \times 4B = 16 {TB}$ contiguous memory</li>
<li>6 level: $12(p1) + 10(p2) + 10(p3) + 10(p4) + 10 (p5) + 12 (offset)$, needs 6 memory accesses</li>
</ol>
<div class = "note info"><p>
    SPAPC(32-bit) and linux use 3-level paging, Motorola 68030 (32-bit) use 4-level paging
</p></div>
</li>
</ul>
<h4 id="hashed-page-table">Hashed Page Table</h4>
<ul>
<li>Commonly-used for address &gt; 32 bits</li>
<li>Virtual page number is hashed into a hash table</li>
<li>The size of the hash table varies, larger hash  table $\rightarrow$  smaller chains in each entry</li>
<li>Each entry in the hashed table contains
<ul>
<li>Virtual Page Number, Frame Number, Next Pointer</li>
<li>Pointers waster memory</li>
<li>Traverse linked list waste time &amp; cause additional memory references
<img src="https://i.loli.net/2019/03/17/5c8dbdd2409f8.png" width=400px/></li>
</ul>
<div class = "note info"><p> 将 entries group 到一起， 存入连续的空间，MMU一次性读进去，可以减少 LinkedList traverse 的时间</p></div>
</li>
</ul>
<h4 id="inverted-page-table-很少见">Inverted Page Table (很少见）</h4>
<ul>
<li>Maintains NO page table for each process ( 节省 memory 空间）</li>
<li>Maintains a <strong>frame table</strong> for the whole memory, one entry for each real frame of memory</li>
<li>Each entry in the frame table has (PID Page number)</li>
<li>Eliminate the memory needed for page tables but increase memory access time, each access needs to search the whole frame table (use hashing for the frame table)</li>
<li>Hard to support <strong>shared/page memory</strong>
<img src="https://i.loli.net/2019/03/17/5c8dc1b979f62.png" width="400px"/></li>
</ul>
<h2 id="segmentation">Segmentation</h2>
<ul>
<li>Memory-management scheme that supports user view of memory</li>
<li>A program is a collection of segments. A segment is a logical unit includes following:
<img src="https://i.loli.net/2019/03/17/5c8dc2e3156bb.png" width="300px"/></li>
</ul>
<h3 id="segmentation-table">Segmentation Table</h3>
<ul>
<li>Logical address: (segmentation #, offset), offset has the same length as physical address</li>
<li>Maps two-dimensional physical addresses, each table entry has:
<ul>
<li>Base (4 bytes): the start physical address</li>
<li>Limit (4 bytes): the length of the segment</li>
</ul>
</li>
<li>Segment-table base register(STBR), the physical address of the segmentation table</li>
<li>Segment-table length register (STLR), the number of segments</li>
<li>example
<img src="https://i.loli.net/2019/04/01/5ca1834f530a6.png" width="400px"/></li>
</ul>
<h3 id="segmentation-hardware">Segmentation Hardware</h3>
<ol>
<li>Limit register is used to check offset length</li>
<li>MMU allocate memory by assigning an appropriate base address for each segment (physical address cannot overlap between segments)
<img src="https://i.loli.net/2019/04/01/5ca1840045b4b.png" width="400px"/></li>
<li>Sharing and Protection
<ul>
<li>Protection bits associated with segments
<ul>
<li>Read-only segment (code)</li>
<li>Read-write segments (data, heap, stack)</li>
<li>Code sharing occurs at segment level (memory communication, shared library)</li>
<li>Share segment by having same base in two segment tables</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="segmentation--paging">Segmentation &amp; paging</h2>
<ul>
<li>Apply segmentation in logical address space</li>
<li>Apply Paging in physical address space
<img src="https://i.loli.net/2019/03/17/5c8dd9bc03335.png" width="400px"/></li>
</ul>
<h3 id="address-translation">Address Translation</h3>
<ul>
<li>CPU generates logical address
<ol>
<li>Given to segmentation unit $\rightarrow$ produces liner address</li>
<li>Linear address given to paging unit $\rightarrow$ generates physical address in main memory</li>
</ol>
</li>
<li>Segmentation and paging units form equivalent of MMU
<img src="https://i.loli.net/2019/03/17/5c8ddd0a0ca4f.png" width="400px"/></li>
</ul>
<h3 id="example">Example</h3>
<ul>
<li>Let the physical memory size is 521B, the page size is 32B and the logical address of a program can have 8 segments. Given a 12 bits hexadecimal logical address &ldquo;448&rdquo;, translate the address with below page and segment tables
<img src="https://i.loli.net/2019/03/17/5c8dde36a59f1.png" width="400px"/></li>
</ul>

          </div>

          



          
          <div class="article-widget">
            
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Previous</div>
    <a href="/courses/operating_system/process/" rel="next">Process</a>
  </div>
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Next</div>
    <a href="/courses/operating_system/virtual_memory/" rel="prev">Virtual Memory</a>
  </div>
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          <p>Last updated on May 5, 2019</p>

          






  
  

<p class="edit-page">
  <a href="https://github.com/zhanghaomiao/academic-kickstart/edit/master/content/courses%5coperating_system%5cmemory_manage.md">
    <i class="fas fa-pen pr-2"></i>Edit this page
  </a>
</p>




          


          


        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    
    Published with
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic Website Builder</a>
    

    
  </p>
</footer>


    </main>
  </div>
</div>


      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js" integrity="sha512-7t8APmYpzEsZP7CYoA7RfMPV9Bb+PJHa9x2WiUnDXZx3XHveuyWUtvNOexhkierl5flZ3tr92dP1mMS+SGlD+A==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/fortran.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/c.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/java.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.3b2b658c61ebd725bd5fc606c89fe44c.js"></script>

    






  
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
